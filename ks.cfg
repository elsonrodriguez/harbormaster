install
url --url=file:///run/install/repo
skipx
text
rootpw default

ignoredisk --only-use=sda
zerombr
clearpart --all --drives=sda --initlabel
part / --size 4096 --grow --fstype xfs --ondisk=sda

network --bootproto=static --ip=172.16.101.100 --netmask=255.255.255.0 --gateway=172.16.101.2 --nameserver=172.16.101.100 --hostname=cobbler

selinux --disabled
firewall --disabled

timezone America/Los_Angeles

#set number of masters until nodes are provisioned.
repo --name="Cobbler" --baseurl=file:///run/install/isodir/cobbler-repo --excludepkgs=systemd,systemd-libs,kpartx

%packages
@ Core
systemd
cobbler
cobbler-web
pykickstart
fence-agents
xinetd
setroubleshoot-server
perl-LockFile-Simple
perl-IO-Compress
perl-Compress-Raw-Zlib
perl-Digest-MD5
perl-Digest-SHA
perl-Net-INET6Glue
perl-LWP-Protocol-https
wget
dhcp
bind
syslinux 
ipxe-bootimgs
%end

services --enabled xinetd,cobblerd,httpd,rsyncd
services --disabled firewalld

%post --nochroot
# We don't actually need EPEL after we install really.
# cp /mnt/source/epel /mnt/sysimage/cobbler/....

cp -a /run/install/isodir/cobbler/etc/* /mnt/sysimage/etc/cobbler/
cp -a /run/install/isodir/cobbler/var/* /mnt/sysimage/var/lib/cobbler/
cp -a /run/install/isodir/cobbler/tftp /mnt/sysimage/etc/xinet.d/tftp
cp -a /run/install/isodir/cobbler/bin/* /mnt/sysimage/usr/local/bin/
%end

%post
#cd /tmp
#curl -O http://ftp.acc.umu.se/mirror/cdimage/snapshot/Debian/pool/main/d/debmirror/debmirror_2.25.tar.xz
#cp debmirror/debmirror /usr/bin/

#cobbler get-loaders --force
#cobbler import --name=ubuntu-server --path=/mnt/source/ubuntu-server-16.04 --breed=ubuntu
#cobbler sync
%end

reboot
